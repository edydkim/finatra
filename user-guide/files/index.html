<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Working With Files &#8212; Finatra User&#39;s Guide 2.12.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.12.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="Finatra User&#39;s Guide 2.12.0 documentation" href="../index.html" />
    <link rel="next" title="Scrooge and Finagle" href="../thrift/basics.html" />
    <link rel="prev" title="JSON Validation Framework" href="../json/validations.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="../_static/small_flask.css" type= "text/css" rel="stylesheet" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39101739-4', 'twitter.github.io');
    ga('send', 'pageview');

  </script>

  </head>
  <body role="document">
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../thrift/basics.html" title="Scrooge and Finagle"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../json/validations.html" title="JSON Validation Framework"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Finatra</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="working-with-files">
<span id="files"></span><h1>Working With Files<a class="headerlink" href="#working-with-files" title="Permalink to this headline">¶</a></h1>
<p>Finatra provides basic file server support which is not meant for high traffic file serving. Do not use the file server for production apps requiring a robust high performance file serving solution.</p>
<div class="section" id="file-locations">
<h2>File Locations<a class="headerlink" href="#file-locations" title="Permalink to this headline">¶</a></h2>
<p>By default, files are served from the root of the classpath. You can use the flag</p>
<div class="code bash highlight-text"><div class="highlight"><pre><span></span>-doc.root
</pre></div>
</div>
<p>to customize the classpath root for finding files.</p>
<p>To serve files from the local filesystem, set the flag</p>
<div class="code bash highlight-text"><div class="highlight"><pre><span></span>-local.doc.root
</pre></div>
</div>
<p>to the location of the file serving directory.</p>
<p>Note that setting Java System Property <cite>-Denv=env</cite> is <strong>no longer required nor supported</strong>. Setting the <cite>-local.doc.root</cite> flag will trigger the same <cite>localFileMode</cite> behavior from Finatra v1.x.</p>
<p>Also note that it is an error to attempt to set both the <cite>-doc.root</cite> and the <cite>-local.doc.root</cite> flags.</p>
<p>Either:</p>
<ul class="simple">
<li>do nothing to load resources from the classpath root <strong>or</strong></li>
<li>configure a classpath &#8220;namespace&#8221; by setting the <cite>-doc.root</cite> flag <strong>or</strong></li>
<li>load files from the local filesystem directory location specified by the <cite>-local.doc.root</cite> flag.</li>
</ul>
<p>Additionally, it is recommend to use local filesystem serving <em>only during testing</em> and <strong>not in production</strong>. It is recommended that you include files to be served as classpath resources in production.</p>
<p>For changes from Finatra v1.x static files behavior see the <a class="reference external" href="../v1-migration/index.html#static-files">Static Files</a> section in the <a class="reference external" href="../v1-migration/index.html">Version 1 Migration Guide</a>.</p>
<p>To set a flag value, pass the flag and its value as an argument to your server:</p>
<div class="code bash highlight-text"><div class="highlight"><pre><span></span>$ java -jar finatra-hello-world-assembly-2.0.0.jar -doc.root=/namespace
</pre></div>
</div>
<p>For more information on using and setting command-line flags see <a class="reference external" href="../getting-started/flags.html#passing-flag-values-as-command-line-arguments">Flags</a>.</p>
</div>
<div class="section" id="file-serving-examples">
<h2>File Serving Examples<a class="headerlink" href="#file-serving-examples" title="Permalink to this headline">¶</a></h2>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>get(&quot;/file&quot;) { request: Request =&gt;
  response.ok.file(&quot;/file123.txt&quot;)
}

get(&quot;/:*&quot;) { request: Request =&gt;
  response.ok.fileOrIndex(
    request.params(&quot;*&quot;),
    &quot;index.html&quot;)
}
</pre></div>
</div>
</div>
<div class="section" id="mustache-templating">
<h2>Mustache Templating<a class="headerlink" href="#mustache-templating" title="Permalink to this headline">¶</a></h2>
<p>Finatra supports the rendering of mustache templates. The framework provides a default <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/main/scala/com/twitter/finatra/http/modules/MustacheModule.scala">MustacheModule</a> but this is configurable. To set your own module, override the mustacheModule def in <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/main/scala/com/twitter/finatra/http/HttpServer.scala#L91">c.t.finatra.http.HttpServer</a>, e.g.,</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>class ExampleServer extends HttpServer {
  override val mustacheModule = MyCustomizedMustacheModule
  ...
}
</pre></div>
</div>
<p>See the <a class="reference external" href="../http/server.html#framework-modules">&#8220;Overriding Default Behavior&#8221;</a> section for more information on providing a customized framework module in your server.</p>
<p>By default mustache templates are loaded from the classpath root. To configure a classpath &#8220;namespace&#8221; for loading mustache templates, set the <cite>-mustache.templates.dir</cite> flag.</p>
<div class="section" id="local-filesystem">
<h3>Local filesystem<a class="headerlink" href="#local-filesystem" title="Permalink to this headline">¶</a></h3>
<p>When you set the <cite>-local.doc.root</cite> flag, the MustacheModule will instead load templates from the local filesystem and templates will be reloaded on every render. This is to aid in local development. Note, that the interplay between the <cite>mustache.temaplates.dir</cite> and the <cite>local.doc.root</cite> flag is as follows:</p>
<ul>
<li><p class="first">in &#8220;local file mode&#8221; (e.g., when the <cite>-local.doc.root</cite> flag is set to a <strong>non-empty</strong> value) the framework will try to load a template first
from the absolute path under <cite>mustache.templates.dir</cite></p>
</li>
<li><p class="first">if the template is not found it will then be loaded from a location of <cite>mustache.templates.dir</cite> relative to the specified <cite>-local.doc.root</cite>, value e.g,</p>
<div class="code bash highlight-text"><div class="highlight"><pre><span></span>/${local.doc.root}/${mustache.templates.dir}/template.mustache
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="rendering">
<h3>Rendering<a class="headerlink" href="#rendering" title="Permalink to this headline">¶</a></h3>
<p>The framework will use mustache to render callback return types that are annotated with the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/main/java/com/twitter/finatra/response/Mustache.java">&#64;Mustache</a> annotation.</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>@Mustache(&quot;foo&quot;)
case class FooView(
  name: String)

get(&quot;/foo&quot;) { request: Request =&gt;
  FooView(&quot;abc&quot;)
}
</pre></div>
</div>
<p>The value of the <code class="docutils literal"><span class="pre">&#64;Mustache</span></code> annotation is assumed by the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/main/scala/com/twitter/finatra/http/internal/marshalling/mustache/MustacheMessageBodyWriter.scala">MustacheMessageBodyWriter</a> to be the template filename without the suffix (which the framework <strong>always assumes</strong> to be <cite>.mustache</cite>).</p>
<p>Or you can manually create a response that explicitly references a template, e.g.,</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>get(&quot;/foo&quot;) { request: Request =&gt;
  response.ok.view(
    &quot;foo.mustache&quot;,
    FooClass(&quot;abc&quot;))
}
</pre></div>
</div>
<p>Or you can programmatically render a template into a string using <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/main/scala/com/twitter/finatra/http/marshalling/mustache/MustacheService.scala#L37">c.t.finatra.http.marshalling.mustache.MustacheService#createString</a> method. This is useful for embedding the resultant content inside a field in a response.</p>
<div class="code scala highlight-text"><div class="highlight"><pre><span></span>case class TestUserView(
  age: Int,
  name: String,
  friends: Seq[String])

case class TestCaseClassWithHtml(
  address: String,
  phone: String,
  renderedHtml: String)

get(&quot;/testClassWithHtml&quot;) { r: Request =&gt;
  val testUser = TestUserView(
    28,
    &quot;Bob Smith&quot;,
    Seq(&quot;user1&quot;, &quot;user2&quot;))

  TestCaseClassWithHtml(
    address = &quot;123 Main St. Anywhere, CA US 90210&quot;,
    phone = &quot;+12221234567&quot;,
    renderedHtml = xml.Utility.escape(mustacheService.createString(&quot;testHtml.mustache&quot;, testUser)))
}
</pre></div>
</div>
<p>See the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/test/DoEverythingServerFeatureTest.scala">test class</a> for more examples.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/finatra_logo.png" alt="Logo"/>
            </a></p><p>
  Finatra is a Scala services framework built on top of <a href="https://twitter.github.io/twitter-server/">TwitterServer</a> and <a href="https://twitter.github.io/finagle/">Finagle</a>.
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://twitter.github.io/finatra/">Site&nbsp;&amp;&nbsp;Blog</a></li>
  <li><a href="https://github.com/twitter/finatra">Github&nbsp;Repository</a></li>
  <li><a href="https://github.com/twitter/finatra/issues">Issues</a></li>
</ul>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Working With Files</a><ul>
<li><a class="reference internal" href="#file-locations">File Locations</a></li>
<li><a class="reference internal" href="#file-serving-examples">File Serving Examples</a></li>
<li><a class="reference internal" href="#mustache-templating">Mustache Templating</a><ul>
<li><a class="reference internal" href="#local-filesystem">Local filesystem</a></li>
<li><a class="reference internal" href="#rendering">Rendering</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../json/validations.html" title="previous chapter">JSON Validation Framework</a></li>
      <li>Next: <a href="../thrift/basics.html" title="next chapter">Scrooge and Finagle</a></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="github-fork-ribbon-wrapper right fixed" style="width: 150px;height: 150px;position: fixed;overflow: hidden;top: 0;z-index: 9999;pointer-events: none;right: 0;"><div class="github-fork-ribbon" style="position: absolute;padding: 2px 0;background-color: #900;background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));-webkit-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);-moz-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);z-index: 9999;pointer-events: auto;top: 42px;right: -43px;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);"><a target="_blank" href="https://github.com/twitter/finatra" style="font: 700 13px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color: #fff;text-decoration: none;text-shadow: 0 -1px rgba(0, 0, 0, 0.5);text-align: center;width: 200px;line-height: 20px;display: inline-block;padding: 2px 0;border-width: 1px 0;border-style: dotted;border-color: rgba(255, 255, 255, 0.7);">Fork me on GitHub</a></div></div>
  

  <div class="footer">
    &copy; Copyright 2013-2017 Twitter, Inc.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</div>
  
  </body>
</html>